
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>Tutorial - Subaerial Drainage System Model (SaDS)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="cyan" data-md-color-accent="red">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Subaerial Drainage System Model (SaDS)" class="md-header-nav__button md-logo" aria-label="Subaerial Drainage System Model (SaDS)">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M634.92 462.7l-288-448C341.03 5.54 330.89 0 320 0s-21.03 5.54-26.92 14.7l-288 448a32.001 32.001 0 00-1.17 32.64A32.004 32.004 0 0032 512h576c11.71 0 22.48-6.39 28.09-16.67a31.983 31.983 0 00-1.17-32.63zM320 91.18L405.39 224H320l-64 64-38.06-38.06L320 91.18z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Subaerial Drainage System Model (SaDS)
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
    
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../startup/" class="md-tabs__link">
        Getting started
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
        
      
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Tutorial
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Subaerial Drainage System Model (SaDS)" class="md-nav__button md-logo" aria-label="Subaerial Drainage System Model (SaDS)">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M634.92 462.7l-288-448C341.03 5.54 330.89 0 320 0s-21.03 5.54-26.92 14.7l-288 448a32.001 32.001 0 00-1.17 32.64A32.004 32.004 0 0032 512h576c11.71 0 22.48-6.39 28.09-16.67a31.983 31.983 0 00-1.17-32.63zM320 91.18L405.39 224H320l-64 64-38.06-38.06L320 91.18z"/></svg>

    </a>
    Subaerial Drainage System Model (SaDS)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      Getting started
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Getting started" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Getting started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../startup/" class="md-nav__link">
      Startup guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/" class="md-nav__link">
      Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    <label class="md-nav__link" for="nav-3">
      Tutorial
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Tutorial
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Tutorial
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-run-the-spinup-case" class="md-nav__link">
    Step 1: Run the spinup case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-run-the-actual-simulation" class="md-nav__link">
    Step 2: Run the actual simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-3-understand-the-outputs" class="md-nav__link">
    Setup 3: Understand the outputs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-analyze-the-outputs" class="md-nav__link">
    Step 4: Analyze the outputs
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-run-the-spinup-case" class="md-nav__link">
    Step 1: Run the spinup case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-run-the-actual-simulation" class="md-nav__link">
    Step 2: Run the actual simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-3-understand-the-outputs" class="md-nav__link">
    Setup 3: Understand the outputs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-analyze-the-outputs" class="md-nav__link">
    Step 4: Analyze the outputs
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="tutorial">Tutorial</h1>
<p>This tutorial takes you through running a simple case using synthetic geometry and forcing. This tutorial is based in the <code>tests/SHMIP/</code> directory. There's a handful of MATLAB files here, so it's useful to talk about what each does:</p>
<ul>
<li><code>get_baseline_setup.m</code> sets most of the parameters for the simulation.</li>
<li><code>shmip_elevation.m</code> calculates the surface elevation for the provided coordinate matrix</li>
<li><code>shmip_melt.m</code> calculates surface melt using the SHMIP melt parameterization.</li>
<li><code>plot_forcing.m</code> plots the SHMIP melt forcing</li>
<li><code>spinup_baseline.</code>: This script runs the "spinup" simulation. Since SaDS builds a supraglacial river network, it's convenient to run the model for a short time (e.g. 12 hours) with spatially uniform channel dimensions to get an estimate of how much flow is through each edge in the mesh.</li>
<li><code>run_test.m</code>: This script is that actually runs the SaDS model. Take a look in it - it doesn't do that much actually since the parameters are set by a different function. It uses the results of the <code>spinup_baseline.m</code> script to calculate initial channel dimensions.</li>
<li><code>pickup_HC.m</code> is a helper function that calculates the channel incision depth for the <code>run_test.m</code> script.</li>
</ul>
<p>The <code>data/</code> folder holds a text file providing moulin locations and the <code>test_mesh.mat</code> file with the triangular mesh.</p>
<p>Note that this case takes some time to run so it might be more convenient to run it on a Compute Canada machine.</p>
<h2 id="step-1-run-the-spinup-case">Step 1: Run the spinup case</h2>
<p>As mentioned above, we run the model for 12 hours with a spatially uniform channel network to get an approximation of the steady state flow through the channels.</p>
<p>First, make sure you have a directory <code>outputs/</code>. This is where the model outputs will be saved.</p>
<p>Now, open the file <code>spinup_baseline.m</code>. This script runs the spinup simulation. See how most of the parameters and initial conditions are set by the <code>get_baseline_setup.m</code> function. Doing it this way ensures that the spinup and actual simulations use the same parameters. Take a look at this function to see what it does.</p>
<p>You should be able to run the spinup case now! If you are running locally (on your own computer as opposed to a Compute Canada machine), just run the script using MATLAB as usual. It only takes a few minutes to run.</p>
<p>If you are on a Compute Canada machine, submit the <code>submit_spinup.sh</code> script:</p>
<div class="highlight"><pre><span></span><code>sbatch submit_spinup.sh
</code></pre></div>
<h2 id="step-2-run-the-actual-simulation">Step 2: Run the actual simulation</h2>
<p>Now we can run the actual simulation. As with the spinup case, look at the script <code>run_test.m</code> to see what it does.</p>
<p>Now, run it using the SLURM script <code>submit_test.sh</code> or as usual if you are running locally. Note this case takes longer to run (up to 30 minutes) so you may want to do it on the Compute Canada machines.</p>
<h2 id="setup-3-understand-the-outputs">Setup 3: Understand the outputs</h2>
<p>While the model is running, you'll notice it produces outputs on the screen (or in the log file) tha t look like</p>
<div class="highlight"><pre><span></span><code>&gt;&gt; spinup_baseline
Using RK time stepping
[             ] (t_model = 15724800.000000, t_wall = 0.515082, AbsConv = 0.000228)
[.            ] (t_model = 15728400.000000, t_wall = 11.874495, AbsConv = 0.027170)
[..           ] (t_model = 15732000.000000, t_wall = 23.229882, AbsConv = 0.086851)
[...          ] (t_model = 15735600.000000, t_wall = 34.564978, AbsConv = 0.073070)
[....         ] (t_model = 15739200.000000, t_wall = 46.411199, AbsConv = 0.088599)
[.....        ] (t_model = 15742800.000000, t_wall = 57.860533, AbsConv = 0.137125)
[......       ] (t_model = 15746400.000000, t_wall = 69.210069, AbsConv = 0.138315)
[.......      ] (t_model = 15750000.000000, t_wall = 80.684014, AbsConv = 0.160151)
[........     ] (t_model = 15753600.000000, t_wall = 92.567800, AbsConv = 0.257627)
[.........    ] (t_model = 15757200.000000, t_wall = 103.861314, AbsConv = 0.197309)
[..........   ] (t_model = 15760800.000000, t_wall = 115.075304, AbsConv = 0.218257)
[...........  ] (t_model = 15764400.000000, t_wall = 126.539341, AbsConv = 0.230892)
[.............] (t_model = 15768000.000000, t_wall = 138.402231, AbsConv = 0.231452)
</code></pre></div>
<p>This provides information on:</p>
<ul>
<li><code>t_model</code>: The timestep (in seconds) the model is currently on. This lets you measure the model's progress. The progress is also visualized with the dots within the square brackets.</li>
<li><code>t_wall</code>: The walltime (in seconds) since the model was started.</li>
<li><code>AbsConv</code>: This is the maximum absolute value of the time derivative of water depth multiplied by the timestep. Essentally, this is how much the water depth is changing within a single timestep. This lets you monitor how well it is doing with the timestep you have chosen.</li>
</ul>
<h2 id="step-4-analyze-the-outputs">Step 4: Analyze the outputs</h2>
<p>Look through the script <code>analyze_outputs.m</code> to see what it does. The <code>element_plot</code> and <code>edge_plot</code> functions are really just interfaces to MATLAB plotting functions but they make your life easy dealing with this weird triangular mesh data. For the most part, you will be using these functions along with standard line plots to visualize your outputs.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../configuration/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Configuration
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['toc.integrate', 'navigation.tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="../javascripts/extra.js"></script>
      
    
  </body>
</html>